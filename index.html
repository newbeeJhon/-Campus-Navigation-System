<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Campus Navigator</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
  <style>
    body { margin: 0; font-family: Arial, sans-serif; }
    #map { height: 100vh; width: 100%; }
    #searchBar {
      position: absolute;
      top: 10px;
      left: 10px;
      background: white;
      padding: 10px;
      border-radius: 8px;
      box-shadow: 0 2px 5px rgba(0,0,0,0.3);
      z-index: 1000;
      width: 250px;
    }
    #errorMsg {
      color: red;
      font-size: 14px;
      margin-top: 5px;
    }
    #coordsBox {
      margin-top: 8px;
      font-size: 13px;
      color: #333;
      background: #f9f9f9;
      padding: 5px;
      border-radius: 5px;
    }
    #addForm {
      margin-top: 10px;
      font-size: 14px;
      background: #f0f0f0;
      padding: 8px;
      border-radius: 5px;
    }
    #addForm input {
      width: 100%;
      margin: 3px 0;
      padding: 5px;
      font-size: 13px;
    }
    #addForm button {
      width: 100%;
      padding: 6px;
      margin-top: 5px;
      background: #4caf50;
      color: white;
      border: none;
      border-radius: 5px;
      cursor: pointer;
    }
    #addForm button:hover {
      background: #45a049;
    }
  </style>
</head>
<body>
  <div id="searchBar">
    <select id="buildingSelect">
      <option value="">-- Select a building --</option>
    </select>
    <button onclick="findBuilding()">Find</button>
    <div id="errorMsg"></div>
    <div id="coordsBox">Click map to get coordinates</div>

    <!-- Add new building form -->
    <div id="addForm">
      <strong>Add Building</strong><br>
      <input type="text" id="newBuildingName" placeholder="Building Name" />
      <input type="text" id="newBuildingX" placeholder="X coordinate" />
      <input type="text" id="newBuildingY" placeholder="Y coordinate" />
      <button onclick="addBuilding()">Add</button>
    </div>
  </div>
  <div id="map"></div>

  <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
  <script>
    // Map with simple CRS (pixel coordinates)
    const map = L.map('map', {
      crs: L.CRS.Simple,
      minZoom: -1
    });

    // Replace with your campus image
    const imageUrl = 'campus_map.png';
    const imageBounds = [[0,0], [1000,1000]]; 
    L.imageOverlay(imageUrl, imageBounds).addTo(map);
    map.fitBounds(imageBounds);

    let buildings = {
      "Library": { x: 200, y: 300 },
      "Canteen": { x: 700, y: 400 },
      "Gym": { x: 500, y: 800 }
    };

    let buildingMarkers = [];

    function populateDropdown() {
      const select = document.getElementById("buildingSelect");
      select.innerHTML = '<option value="">-- Select a building --</option>';
      Object.keys(buildings).forEach(name => {
        const opt = document.createElement("option");
        opt.value = name;
        opt.textContent = name;
        select.appendChild(opt);
      });
    }

    function showAllBuildingMarkers() {
      buildingMarkers.forEach(m => map.removeLayer(m));
      buildingMarkers = [];

      Object.entries(buildings).forEach(([name, coords]) => {
        const marker = L.marker([coords.y, coords.x])
          .addTo(map)
          .bindPopup(name);
        buildingMarkers.push(marker);
      });
    }

    function findBuilding() {
      const query = document.getElementById("buildingSelect").value;
      if (!query || !buildings[query]) {
        document.getElementById("errorMsg").innerText = "Building not found.";
        return;
      }
      document.getElementById("errorMsg").innerText = "";
      const { x, y } = buildings[query];
      map.setView([y, x], 0);
    }

    // Add building via form
    function addBuilding() {
      const name = document.getElementById("newBuildingName").value.trim();
      const x = parseInt(document.getElementById("newBuildingX").value.trim());
      const y = parseInt(document.getElementById("newBuildingY").value.trim());

      if (!name || isNaN(x) || isNaN(y)) {
        alert("Please enter valid name and coordinates.");
        return;
      }

      // Add to buildings object
      buildings[name] = { x, y };

      // Update dropdown + markers
      populateDropdown();
      showAllBuildingMarkers();

      // Reset form
      document.getElementById("newBuildingName").value = "";
      document.getElementById("newBuildingX").value = "";
      document.getElementById("newBuildingY").value = "";

      alert(`Added building: ${name}`);
    }

    // Click to get coordinates
    map.on('click', function(e) {
      const coordsBox = document.getElementById("coordsBox");
      const x = e.latlng.lng.toFixed(0);
      const y = e.latlng.lat.toFixed(0);
      coordsBox.innerText = `Clicked: { x: ${x}, y: ${y} }`;
      L.marker([y, x]).addTo(map).bindPopup(`x:${x}, y:${y}`).openPopup();
    });

    // Init
    populateDropdown();
    showAllBuildingMarkers();
  </script>
</body>
</html>

